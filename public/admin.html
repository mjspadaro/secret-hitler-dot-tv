<!doctype html>
<html>
  <head>
    <title>Secret Hitler</title>

		<script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script>

		  $(function () {
				
				var gameId = sessionStorage.getItem('hostGameId');
		    var socket = io();
				
				if (gameId) {
					socket.emit('rejoinGame', gameId, '', function (success){
						if (success) {
							console.log('Successfully rejoined game');
						}
						else {
							socket.emit('hostNewGame')
							console.log('Unable to rejoin game');
						}
					}); 
				}
				else {
					console.log('Requesting new game.');
					socket.emit('hostNewGame');
				}
				
				socket.on('reconnect', function() {
					if (gameId) {
						socket.emit('rejoinGame', gameId, false, function (success) {
							if (success) {
								console.log('Successfully rejoined game');
							}
							else {
								socket.emit('hostNewGame')
								console.log('Unable to rejoin game');
							}
						});
 				 	}
				});
				
				socket.on('gameEvent', function (event){
					gameId = event.state.id;
					//sessionStorage.setItem('hostGameId', gameId);
					console.log(event);
					render(event);
				});
				
				function render(event)
				{
					$('#game-events').append(`<li>${event.playerName}: ${event.eventName} ${event.data}</li>\n`);
					$('#status-bar').html(`Secret Hitler - ${event.state.id}`);
					$('#game-state').html(JSON.stringify(event.state, null, 2));
				}

				
		  });
			
			
		</script>
		
  </head>
  <body>
		<div id="status-bar">Secret Hitler</div>
		<table style="width: 100%">
			<tr>
				<td style="vertical-align: top; overflow: scroll; width: 50%;">
					<ul id="game-events" style="border: solid 2px; overflow: auto; height: 500px;">
					</ul>
				</td>
				<td style="vertical-align: top; overflow: scroll; width: 50%;">
					<pre id="game-state"></pre>
				</td>		
			</tr>
		</table>
		
		<form id="player-action" style="">

		</form>
  </body>
</html>